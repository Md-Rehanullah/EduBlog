<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - EduBlog</title>
    <meta name="description" content="Admin dashboard for managing EduBlog content">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="nav-container">
                <div class="nav-brand">
                    <a href="index.html"><h1>EduBlog</h1></a>
                </div>
                
                <div class="nav-menu" id="nav-menu">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="about.html" class="nav-link">About</a>
                    <a href="index.html#content" class="nav-link">Content</a>
                    <a href="index.html#contact" class="nav-link">Contact</a>
                    <a href="privacy-policy.html" class="nav-link">Privacy</a>
                    <a href="terms-conditions.html" class="nav-link">Terms</a>
                    <a href="sitemap.html" class="nav-link">Sitemap</a>
                    <a href="dashboard.html" class="nav-link active">Dashboard</a>
                </div>
                
                <button class="nav-toggle" id="nav-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <section class="page-header">
            <div class="container">
                <h1>Dashboard</h1>
                <p>Manage your EduBlog content</p>
            </div>
        </section>

        <section class="dashboard-content">
            <div class="container">
                <div id="dashboard-auth" class="dashboard-auth">
                    <div class="auth-form">
                        <h2>Admin Authentication</h2>
                        <p>Please enter your password to access the dashboard</p>
                        <form id="dashboard-password-form">
                            <div class="form-group">
                                <label for="dashboard-password">Password</label>
                                <input type="password" id="dashboard-password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Authenticate</button>
                        </form>
                    </div>
                </div>

                <div id="dashboard-main" class="dashboard-main" style="display: none;">
                    <div class="dashboard-actions">
                        <button id="create-new-post" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Create New Post
                        </button>
                        <button id="refresh-posts" class="btn btn-outline">
                            <i class="fas fa-sync-alt"></i> Refresh Posts
                        </button>
                    </div>

                    <div class="posts-list">
                        <h2>Your Posts</h2>
                        <div class="posts-filter">
                            <select id="posts-filter">
                                <option value="all">All Posts</option>
                                <option value="blog">Blogs</option>
                                <option value="story">Stories</option>
                                <option value="news">News</option>
                                <option value="published">Published</option>
                                <option value="drafts">Drafts</option>
                            </select>
                        </div>
                        <div id="posts-container" class="posts-container">
                            <!-- Posts will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>EduBlog</h3>
                    <p>Empowering students through educational content, inspiring stories, and academic guidance.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="index.html#content">Content</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="index.html#contact">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="terms-conditions.html">Terms & Conditions</a></li>
                        <li><a href="sitemap.html">Sitemap</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Connect</h4>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-linkedin"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 EduBlog. All rights reserved. Built with passion for education.</p>
            </div>
        </div>
    </footer>

    <!-- Post Editor Modal -->
    <div id="post-editor-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="editor-title">Create New Post</h2>
                <button type="button" id="close-editor-modal" class="close-btn">&times;</button>
            </div>
            <form id="post-editor-form" class="create-post-form">
                <input type="hidden" id="edit-post-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-post-title">Title *</label>
                        <input type="text" id="edit-post-title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-post-type">Content Type *</label>
                        <select id="edit-post-type" name="contentType" required>
                            <option value="">Select type...</option>
                            <option value="blog">Blog</option>
                            <option value="story">Story</option>
                            <option value="news">News</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-post-excerpt">Excerpt *</label>
                    <textarea id="edit-post-excerpt" name="excerpt" rows="3" required placeholder="Brief description of your content..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="edit-post-content">Content *</label>
                    <textarea id="edit-post-content" name="content" rows="15" required placeholder="Write your content here... You can use markdown formatting."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="edit-post-tags">Tags (comma-separated)</label>
                    <input type="text" id="edit-post-tags" name="tags" placeholder="e.g., education, study tips, motivation">
                </div>
                
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="edit-post-published" name="published">
                        <span class="checkmark"></span>
                        Publish this post
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" id="cancel-edit" class="btn btn-outline">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Post</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="confirm-title">Confirm Action</h2>
            </div>
            <div class="modal-body">
                <p id="confirm-message">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-actions">
                <button type="button" id="confirm-cancel" class="btn btn-outline">Cancel</button>
                <button type="button" id="confirm-action" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Dashboard-specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Check if already authenticated
            if (localStorage.getItem('dashboardAuthenticated') {
                showDashboard();
            }

            // Password form
            const passwordForm = document.getElementById('dashboard-password-form');
            if (passwordForm) {
                passwordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const password = document.getElementById('dashboard-password').value;
                    if (password === 'admin123') {
                        localStorage.setItem('dashboardAuthenticated', 'true');
                        showDashboard();
                    } else {
                        alert('Incorrect password. Please try again.');
                    }
                });
            }

            // Create new post button
            const createPostBtn = document.getElementById('create-new-post');
            if (createPostBtn) {
                createPostBtn.addEventListener('click', function() {
                    openPostEditor();
                });
            }

            // Refresh posts button
            const refreshBtn = document.getElementById('refresh-posts');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    loadPosts();
                });
            }

            // Filter posts
            const filterSelect = document.getElementById('posts-filter');
            if (filterSelect) {
                filterSelect.addEventListener('change', function() {
                    loadPosts(this.value);
                });
            }

            // Load initial posts
            if (localStorage.getItem('dashboardAuthenticated')) {
                loadPosts();
            }
        });

        function showDashboard() {
            document.getElementById('dashboard-auth').style.display = 'none';
            document.getElementById('dashboard-main').style.display = 'block';
        }

        function loadPosts(filter = 'all') {
            const postsContainer = document.getElementById('posts-container');
            postsContainer.innerHTML = '<div class="loading"><div class="spinner"></div> Loading posts...</div>';

            // Get posts from the global posts array (loaded in script.js)
            let filteredPosts = [...posts];
            
            if (filter === 'blog') {
                filteredPosts = filteredPosts.filter(post => post.contentType === 'blog');
            } else if (filter === 'story') {
                filteredPosts = filteredPosts.filter(post => post.contentType === 'story');
            } else if (filter === 'news') {
                filteredPosts = filteredPosts.filter(post => post.contentType === 'news');
            } else if (filter === 'published') {
                filteredPosts = filteredPosts.filter(post => post.isPublished);
            } else if (filter === 'drafts') {
                filteredPosts = filteredPosts.filter(post => !post.isPublished);
            }

            if (filteredPosts.length === 0) {
                postsContainer.innerHTML = '<p class="loading">No posts found.</p>';
                return;
            }

            postsContainer.innerHTML = '';
            filteredPosts.forEach(post => {
                const postElement = createPostElement(post);
                postsContainer.appendChild(postElement);
            });
        }

        function createPostElement(post) {
            const element = document.createElement('div');
            element.className = 'post-item';
            element.dataset.id = post.id;
            
            const publishedDate = new Date(post.publishedAt).toLocaleDateString();
            const status = post.isPublished ? 'Published' : 'Draft';
            const statusClass = post.isPublished ? 'published' : 'draft';
            
            element.innerHTML = `
                <div class="post-header">
                    <h3>${post.title}</h3>
                    <div class="post-meta">
                        <span class="content-badge ${post.contentType}">${post.contentType}</span>
                        <span class="status ${statusClass}">${status}</span>
                        <span>${publishedDate}</span>
                    </div>
                </div>
                <div class="post-excerpt">${post.excerpt}</div>
                <div class="post-actions">
                    <button class="btn btn-outline edit-post" data-id="${post.id}">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-outline delete-post" data-id="${post.id}">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                    <button class="btn btn-outline ${post.isPublished ? 'unpublish-post' : 'publish-post'}" data-id="${post.id}">
                        <i class="fas fa-${post.isPublished ? 'eye-slash' : 'eye'}"></i> ${post.isPublished ? 'Unpublish' : 'Publish'}
                    </button>
                </div>
            `;
            
            return element;
        }

        function openPostEditor(postId = null) {
            const modal = document.getElementById('post-editor-modal');
            const form = document.getElementById('post-editor-form');
            
            if (postId) {
                // Editing existing post
                const post = posts.find(p => p.id === postId);
                if (!post) return;
                
                document.getElementById('editor-title').textContent = 'Edit Post';
                document.getElementById('edit-post-id').value = post.id;
                document.getElementById('edit-post-title').value = post.title;
                document.getElementById('edit-post-type').value = post.contentType;
                document.getElementById('edit-post-excerpt').value = post.excerpt;
                document.getElementById('edit-post-content').value = post.content;
                document.getElementById('edit-post-tags').value = post.tags ? post.tags.join(', ') : '';
                document.getElementById('edit-post-published').checked = post.isPublished;
            } else {
                // Creating new post
                document.getElementById('editor-title').textContent = 'Create New Post';
                form.reset();
                document.getElementById('edit-post-published').checked = true;
            }
            
            modal.classList.add('active');
        }

        // Add event listeners for post actions
        document.addEventListener('click', function(e) {
            if (e.target.closest('.edit-post')) {
                const postId = parseInt(e.target.closest('.edit-post').dataset.id);
                openPostEditor(postId);
            }
            
            if (e.target.closest('.delete-post')) {
                const postId = parseInt(e.target.closest('.delete-post').dataset.id);
                confirmDelete(postId);
            }
            
            if (e.target.closest('.publish-post, .unpublish-post')) {
                const postId = parseInt(e.target.closest('.publish-post, .unpublish-post').dataset.id);
                togglePublish(postId);
            }
        });

        // Post editor form
        const postEditorForm = document.getElementById('post-editor-form');
        if (postEditorForm) {
            postEditorForm.addEventListener('submit', function(e) {
                e.preventDefault();
                savePost();
            });
        }

        // Close editor modal
        const closeEditor = document.getElementById('close-editor-modal');
        if (closeEditor) {
            closeEditor.addEventListener('click', function() {
                document.getElementById('post-editor-modal').classList.remove('active');
            });
        }

        // Cancel edit
        const cancelEdit = document.getElementById('cancel-edit');
        if (cancelEdit) {
            cancelEdit.addEventListener('click', function() {
                document.getElementById('post-editor-modal').classList.remove('active');
            });
        }

        async function savePost() {
            const form = document.getElementById('post-editor-form');
            const postId = document.getElementById('edit-post-id').value;
            const isNew = !postId;
            
            const postData = {
                id: isNew ? Date.now() : parseInt(postId),
                title: document.getElementById('edit-post-title').value,
                contentType: document.getElementById('edit-post-type').value,
                excerpt: document.getElementById('edit-post-excerpt').value,
                content: document.getElementById('edit-post-content').value,
                tags: document.getElementById('edit-post-tags').value.split(',').map(t => t.trim()),
                publishedAt: new Date().toISOString().split('T')[0],
                isPublished: document.getElementById('edit-post-published').checked
            };
            
            if (isNew) {
                posts.unshift(postData);
            } else {
                const index = posts.findIndex(p => p.id === postData.id);
                if (index !== -1) {
                    posts[index] = postData;
                }
            }
            
            // Save to Gist and localStorage
            try {
                await savePostsToGist();
                localStorage.setItem('edublog-posts', JSON.stringify(posts));
                showToast('Post saved successfully!');
                document.getElementById('post-editor-modal').classList.remove('active');
                loadPosts(document.getElementById('posts-filter').value);
            } catch (error) {
                showToast('Error saving post. Please try again.', 'error');
                console.error(error);
            }
        }

        function confirmDelete(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            const modal = document.getElementById('confirm-modal');
            const message = document.getElementById('confirm-message');
            const confirmBtn = document.getElementById('confirm-action');
            
            message.textContent = `Are you sure you want to delete the post "${post.title}"? This action cannot be undone.`;
            
            // Store postId in confirm button
            confirmBtn.dataset.id = postId;
            
            modal.classList.add('active');
            
            // Handle confirm action
            confirmBtn.onclick = async function() {
                const idToDelete = parseInt(this.dataset.id);
                posts = posts.filter(p => p.id !== idToDelete);
                
                try {
                    await savePostsToGist();
                    localStorage.setItem('edublog-posts', JSON.stringify(posts));
                    showToast('Post deleted successfully!');
                    loadPosts(document.getElementById('posts-filter').value);
                } catch (error) {
                    showToast('Error deleting post. Please try again.', 'error');
                    console.error(error);
                }
                
                modal.classList.remove('active');
            };
            
            // Handle cancel
            document.getElementById('confirm-cancel').onclick = function() {
                modal.classList.remove('active');
            };
        }

        async function togglePublish(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            post.isPublished = !post.isPublished;
            
            try {
                await savePostsToGist();
                localStorage.setItem('edublog-posts', JSON.stringify(posts));
                showToast(`Post ${post.isPublished ? 'published' : 'unpublished'} successfully!`);
                loadPosts(document.getElementById('posts-filter').value);
            } catch (error) {
                showToast('Error updating post. Please try again.', 'error');
                console.error(error);
            }
        }
    </script>
</body>
</html>
